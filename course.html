<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Syllabus</title>
	<link rel="stylesheet" type="text/css" href="course.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script type="text/javascript">
		const syllabusList = [];
		const syllabusListErrors = [];
		var errorData = {isTitleValid:true,isDescriptionValid:true,isTagsValid:true}

		function addSyllabus() {
			let emptySyllabusItem = {title:"",description:"",tags:"",editMode:true};
			syllabusList.push(emptySyllabusItem);
			syllabusListErrors.push(errorData);
			renderCards();
		}

		function createCard(index, syllabusItem) {
			let card = `<div id="card" class="syllabusCard">
								<div id="cardBody" class="cardBody">
									<div id="anchorDiv">
										<a class="index">Syllabus ${index + 1}</a>
									</div>
									<h2 class="cardTitle">${syllabusItem["title"]}</h2>
									<p class="cardDescription">${syllabusItem["description"]}</p>
									<ul id="nav$" class="actionsNav alignRight">
										<li class="actionsNav-item">
											<a id="editbtn" href="javascript:edit(${index})" class="actionsNav-link">Edit</a>
										</li>
										<li class="actionsNav-item">
											<a href="javascript:deleteSyllabus(${index})" class="actionsNav-link">Delete</a>
										</li>
									</ul>
								</div>
						</div>`;
			return card;
		}

		function renderCards() {
			let index = 0;
			$("#cardsDiv").html("");
			for (const syllabusItem of syllabusList) {
				if (!syllabusItem["editMode"]) {
					var HTMLTemplate = createCard(index, syllabusItem);
				}
				else {
					var HTMLTemplate = showForm(index, syllabusItem)
				}
				$("#cardsDiv").append(HTMLTemplate);
				index++;
			}
		}

		function showForm(index, syllabusItem) {
			syllabusItemError = syllabusListErrors[index];
			let formhtml = `<input type="text" name="syllabusTitle${index}" id="syllabusTitle${index}" class="textBox" value="${syllabusItem["title"]}">`;
			if (!syllabusItemError["isTitleValid"]) {
				formhtml += `<p class="errorMessage">Invalid Title</p>`;
			}
			let formhtml1 = `<input type="text" name="syllabusDescription${index}" id="syllabusDescription${index}" class="textBox" value="${syllabusItem["description"]}">`;
			if (!syllabusItemError["isDescriptionValid"]) {
				formhtml1 += `<p class="errorMessage">Invalid Description</p>`;
			}
			let formhtml2 = `<input type="text" name="syllabusTags${index}" id="syllabusTags${index}" class="textBox" value="${syllabusItem["tags"]}">`;
			if (!syllabusItemError["isTagsValid"]) {
				formhtml2 += `<p class="errorMessage">Invalid Tags</p>`;
			}
			let form = `<div id="form" name="formFields">
								<div class="formIndex">
									<a class="index" id="index">Syllabus ${index + 1}</a>
								</div>
								<label for="syllabusTitle${index}" class="textBoxLabel">Title</label>
								${formhtml}
								<label for="syllabusDescription${index}" class="textBoxLabel">Description</label>
								${formhtml1}
								<label for="syllabusTags${index}" class="textBoxLabel">Tags</label>
								${formhtml2}								
								<button id="savebtn" class="alignRight formBtn" onclick="saveData(${index})">Save</button>
								<button class="alignRight formBtn" onclick="cancel(${index})">Cancel</button>
						</div>`;
			return form;
		}

		function cancel(index) {
			if(index + 1 == syllabusList.length) {
				deleteSyllabus(index);
			}
			else{
				syllabusList[index]["editMode"]= false;
			}
			renderCards();
		}

		function deleteSyllabus(index) {
			syllabusList.splice(index, 1);
			syllabusListErrors.splice(index, 1);
			renderCards();
		}

		function edit(index) {
			syllabusList[index]["editMode"] = true;
			renderCards();
		}

		function saveData(index) {
			let title = $("#syllabusTitle"+index).val();
			let description = $("#syllabusDescription"+index).val();
			let tags = $("#syllabusTags"+index).val();
			if (title.length <= 0) {
				errorData.isTitleValid = false;
				editMode = true;
			}
			if (description.length <= 0) {
				errorData.isDescriptionValid = false;
				editMode = true;
			}
			if (tags.length <= 0) {
				errorData.isTagsValid = false;
				editMode = true;
			}
			if (errorData.isTitleValid && errorData.isDescriptionValid && errorData.isTagsValid) {
				editMode = false;
			}
			formData = {title:title,description:description,tags:tags, editMode:editMode};
			// values = JSON.stringify( $("#form").serialize());
			// console.log(values);
			syllabusList[index] = formData;
			syllabusListErrors[index] = errorData;
			renderCards();
		}
	</script>
</head>
<body>
	<button class="addSyllabus alignRight" id="addSyllabus" onclick="addSyllabus()">Add Syllabus</button>
	<div style="border: 1px solid #fff;" class="container cardContainer" id="cardsDiv"></div>
</body>
</html>
